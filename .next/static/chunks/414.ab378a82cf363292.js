(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[414],{1299:(e,t,i)=>{"use strict";var s=i(7720),n=i(7548);class a{init(){let e=new s.iNn(1,1,1),t=document.createElement("canvas");t.width=64,t.height=64;let i=t.getContext("2d");i.fillStyle="#D2691E",i.fillRect(0,0,64,64),i.fillStyle="black",i.fillRect(15,20,10,10),i.fillRect(39,20,10,10),i.fillRect(20,45,24,6);let n=new s.GOR(t);n.magFilter=s.hxR,n.minFilter=s.hxR;let a=new s._4j({map:n,roughness:.8,metalness:0});this.mesh=new s.eaF(e,a),this.mesh.position.y=this.yPos,this.game.scene.add(this.mesh);let o=new s.O3Y(1.2,.05,16,32);this.magnetRingMat=new s.V9B({color:65535,transparent:!0,opacity:.5}),this.magnetRing=new s.eaF(o,this.magnetRingMat),this.magnetRing.rotation.x=Math.PI/2,this.magnetRing.visible=!1,this.game.scene.add(this.magnetRing),window.addEventListener("keydown",e=>this.onKeyDown(e));let r=new s.O3Y(.3,.1,8,16,Math.PI),l=new s._4j({color:0xffd700,metalness:1,roughness:.3});this.horseShoe=new s.eaF(r,l),this.horseShoe.position.set(0,.3,.6),this.horseShoe.rotation.z=Math.PI,this.horseShoe.visible=!1,this.mesh.add(this.horseShoe),this.moltenPointLight=new s.HiM(0xff4500,0,10),this.game.scene.add(this.moltenPointLight);let h=new s.Gu$(.8,16,16),c=new s.V9B({color:0xff4500,transparent:!0,opacity:0,side:s.hsX,blending:s.EZo});this.moltenHalo=new s.eaF(h,c),this.mesh.add(this.moltenHalo),this.setSkin(this.game.equippedSkin),this.updateCosmetic()}reset(){this.lane=0,this.mesh.position.x=0,this.mesh.position.y=.5,this.velocity=0,this.isJumping=!1,this.setMagnetEffect(!1)}onKeyDown(e){if(this.game.isPlaying)switch(e.code){case"ArrowLeft":case"KeyA":this.moveLeft();break;case"ArrowRight":case"KeyD":this.moveRight();break;case"ArrowUp":case"KeyW":case"Space":this.jump()}}moveLeft(){this.game.isPlaying&&this.lane>-1&&this.lane--}moveRight(){this.game.isPlaying&&this.lane<1&&this.lane++}jump(){this.game.isPlaying&&(this.isJumping||(this.velocity=12,this.isJumping=!0,this.game.playSfx("jump"),"Molten Core"===this.game.equippedSkin&&(this.flareTimer=.5)))}update(e,t){let i=this.lane*this.laneWidth,s=10,n=0;if("sandstorm"===this.game.weatherType&&(s=4,n=.8*Math.sin(.003*Date.now())),this.mesh.position.x+=(i+n-this.mesh.position.x)*s*e,this.mesh.position.x=Math.max(-2,Math.min(2,this.mesh.position.x)),this.isJumping?(this.mesh.position.y+=this.velocity*e,this.velocity+=this.gravity*e,this.wasInAir=!0,this.mesh.position.y<=.5&&(this.mesh.position.y=.5,this.isJumping=!1,this.velocity=0,this.handleLanding())):this.wasInAir=!1,this.spawnContinuousEffects(e),this.magnetRing.visible)if(this.magnetRing.position.x=this.mesh.position.x,this.magnetRing.position.z=this.mesh.position.z,this.magnetRing.position.y=.1,this.magnetRing.rotation.z+=3*e,this.game.magnetActive&&this.game.magnetTimer<=5){let e=this.game.magnetTimer;this.magnetRingMat.opacity=.5*Math.sin(.001*Date.now()*(e<=2?20:10))+.5}else this.magnetRingMat.opacity=.5;if(this.isJumping?this.mesh.rotation.x-=t*e*.5:this.mesh.rotation.x-=t*e,this.horseShoe.visible&&(this.horseShoe.rotation.y+=5*e),this.game.potionActive&&this.game.potionTimer<=3?this.mesh.visible=Math.floor(Date.now()/100)%2==0:this.game.isPlaying&&(this.mesh.visible=!0),"Molten Core"===this.game.equippedSkin){let t=.5+.5*Math.sin(.005*Date.now()),i=this.mesh.material,s=this.moltenHalo.material;this.flareTimer>0&&(this.flareTimer-=e);let n=this.flareTimer>0?this.flareTimer/.5*2:0;i.emissiveIntensity=1+ +t+n,s.opacity=(.2+.2*t+.3*n)*!!this.game.isPlaying,this.moltenPointLight.position.copy(this.mesh.position),this.moltenPointLight.intensity=(2+2*t+4*n)*!!this.game.isPlaying,this.moltenPointLight.color.setHex(this.flareTimer>0?0xffaa00:0xff4500),this.moltenHalo.visible=!0}else this.moltenPointLight.intensity=0,this.moltenHalo.visible=!1}setMagnetEffect(e){this.magnetRing&&(this.magnetRing.visible=e)}setMetallicSkin(e){if(!this.mesh)return;let t=this.mesh.material;e?(t.color.set(0xaaaaaa),t.metalness=1,t.roughness=.2):(t.color.set(0xffffff),t.metalness=0,t.roughness=.8)}updateCosmetic(){this.horseShoe&&(this.horseShoe.visible=this.game.hasHorseshoe)}setSkin(e){if(!this.mesh)return;let t=this.mesh.material;switch(t.emissiveIntensity=0,t.emissive.setHex(0),e){case"Classic Farmer":t.color.set("#D2691E"),t.metalness=0,t.roughness=.8;break;case"Iron Knight":t.color.set("#C0C0C0"),t.metalness=1,t.roughness=.2;break;case"Neon Runner":t.color.set("#00FFFF"),t.emissive.set("#00FFFF"),t.emissiveIntensity=.5,t.metalness=.5,t.roughness=.5;break;case"Golden Dash":t.color.set("#FFD700"),t.metalness=1,t.roughness=.2,t.emissive.set("#997700"),t.emissiveIntensity=.5,t.map=null;break;case"Molten Core":let i=document.createElement("canvas");i.width=128,i.height=128;let n=i.getContext("2d");n.fillStyle="#4B0000",n.fillRect(0,0,128,128);for(let e=0;e<40;e++)n.strokeStyle=Math.random()>.5?"#FF4500":"#FF8C00",n.lineWidth=5*Math.random()+2,n.beginPath(),n.moveTo(128*Math.random(),128*Math.random()),n.lineTo(128*Math.random(),128*Math.random()),n.stroke();let a=n.createRadialGradient(64,64,5,64,64,50);a.addColorStop(0,"#FFFFFF"),a.addColorStop(.2,"#FFFF00"),a.addColorStop(1,"rgba(255, 69, 0, 0)"),n.fillStyle=a,n.fillRect(0,0,128,128),t.map=new s.GOR(i),t.color.set("#FFFFFF"),t.emissive.set("#FF4500"),t.emissiveIntensity=1,t.metalness=.5,t.roughness=.4,this.moltenPointLight.intensity=5,this.moltenHalo.visible=!0;break;default:t.color.set("#D2691E"),this.moltenPointLight.intensity=0,this.moltenHalo.visible=!1}}handleLanding(){if("Iron Knight"===this.game.equippedSkin){let e=this.mesh.position.clone();e.y=.1,this.game.world.spawnGenericParticles(e,8,0xffff00,.1,4,.5,!0)}}spawnContinuousEffects(e){this.effectTimer+=e,this.trailTimer+=e;let t=this.game.equippedSkin,i=this.mesh.position.clone(),n=i.clone();if(n.y=.1,n.z+=.5,"Classic Farmer"===t)this.trailTimer>.1&&!this.isJumping&&(this.game.world.spawnGenericParticles(n,1,0xd2b48c,.1,1,.5,!1),this.trailTimer=0);else if("Neon Runner"===t){if(this.mesh.material.emissiveIntensity=.5+.3*Math.sin(.01*Date.now()),this.effectTimer>.05){let e=i.clone().add(new s.Pq0((Math.random()-.5)*1.2,(Math.random()-.5)*1.2,(Math.random()-.5)*1.2));this.game.world.spawnGenericParticles(e,1,65535,.05,.5,.3,!0),this.effectTimer=0}this.trailTimer>.02&&(this.game.world.spawnGenericParticles(i,2,65535,.15,.1,.4,!0),this.trailTimer=0)}else if("Golden Dash"===t){this.shimmerTimer+=e;let t=this.mesh.material;if(this.shimmerTimer>2?(t.emissiveIntensity=1.5*(.5*Math.sin(.01*Date.now())+.5),this.shimmerTimer>2.5&&(this.shimmerTimer=0)):t.emissiveIntensity=.5,this.trailTimer>.1){let e=i.clone().add(new s.Pq0(0,0,.5));this.game.world.spawnGenericParticles(e,5,0xffff00,.2,2,.8,!0),this.trailTimer=0}if(this.coinTrailTimer+=e,this.coinTrailTimer>.15){let e=i.clone().add(new s.Pq0((Math.random()-.5)*1.5,(Math.random()-.5)*1.5,.8));this.game.world.spawnGenericParticles(e,1,0xffffff,.1,3,.5,!0),this.coinTrailTimer=0}}else if("Molten Core"===t){if(this.trailTimer>.08){let e=i.clone().add(new s.Pq0((Math.random()-.5)*.5,-.5,(Math.random()-.5)*.5));if(this.game.world.spawnGenericParticles(e,1,2236962,.2,1.5,1.2,!1),.4>Math.random()){let e=i.clone().add(new s.Pq0((Math.random()-.5)*1,(Math.random()-.5)*1,(Math.random()-.5)*1));this.game.world.spawnGenericParticles(e,2,0xff8c00,.05,3,.6,!0)}this.trailTimer=0}this.burnTimer+=e,this.burnTimer>=.12&&!this.isJumping&&(this.game.world.spawnBurnMark(this.mesh.position),this.burnTimer=0)}}constructor(e){this.effectTimer=0,this.trailTimer=0,this.burnTimer=0,this.wasInAir=!1,this.shimmerTimer=0,this.coinTrailTimer=0,this.flareTimer=0,this.game=e,this.lane=0,this.laneWidth=2,this.velocity=0,this.gravity=-30,this.isJumping=!1,this.yPos=.5,this.init()}}class o{init(){this.initSharedAssets();for(let e=0;e<5;e++)this.spawnFloor(-e*this.segmentLength);this.initWeatherParticles()}initSharedAssets(){this.particleGeo=new s.iNn(1,1,1)}initWeatherParticles(){let e=new s.LoY,t=new Float32Array(6e3);for(let e=0;e<6e3;e++)t[e]=(Math.random()-.5)*40;e.setAttribute("position",new s.THS(t,3));let i=new s.BH$({size:.1,transparent:!0,opacity:.6,color:0xffffff});this.weatherParticles=new s.ONl(e,i),this.game.scene.add(this.weatherParticles),this.weatherParticles.visible=!1}reset(){this.obstacles.forEach(e=>{e.visible=!1;let t=e.userData.type||"crate";this.obstaclePool[t]||(this.obstaclePool[t]=[]),this.obstaclePool[t].push(e)}),this.obstacles=[],this.coins.forEach(e=>{e.visible=!1,this.coinPool.push(e)}),this.coins=[],this.particles.forEach(e=>this.game.scene.remove(e)),this.particles=[],this.floorSegments.forEach(e=>this.game.scene.remove(e)),this.floorSegments=[],this.decals.forEach(e=>this.game.scene.remove(e)),this.decals=[],this.lastSpawnZ=0,this.jades.forEach(e=>{e.visible=!1,this.jadePool.push(e)}),this.jades=[];for(let e=0;e<6;e++)this.spawnFloor(-e*this.segmentLength);for(let e=-20;e>-300;e-=10){let t=Math.random();t<.4?this.spawnObstacle(e):t>.6&&this.spawnCoin(e)}}spawnFloor(e){let t=new s.YJl;if(!this.dirtTexture){let e=document.createElement("canvas");e.width=64,e.height=64;let t=e.getContext("2d");t.fillStyle="#5D4037",t.fillRect(0,0,64,64);for(let e=0;e<200;e++)t.fillStyle=Math.random()>.5?"#3E2723":"#795548",t.fillRect(Math.floor(64*Math.random()),Math.floor(64*Math.random()),2,2);this.dirtTexture=new s.GOR(e),this.dirtTexture.magFilter=s.hxR,this.dirtTexture.minFilter=s.hxR,this.dirtTexture.wrapS=s.GJx,this.dirtTexture.wrapT=s.GJx,this.dirtTexture.repeat.set(1,10)}if(!this.grassTexture){let e=document.createElement("canvas");e.width=64,e.height=64;let t=e.getContext("2d");t.fillStyle="#4CAF50",t.fillRect(0,0,64,64);for(let e=0;e<300;e++)t.fillStyle=Math.random()>.5?"#388E3C":"#81C784",t.fillRect(Math.floor(64*Math.random()),Math.floor(64*Math.random()),2,2);this.grassTexture=new s.GOR(e),this.grassTexture.magFilter=s.hxR,this.grassTexture.minFilter=s.hxR,this.grassTexture.wrapS=s.GJx,this.grassTexture.wrapT=s.GJx,this.grassTexture.repeat.set(4,10)}this.roadGeo||(this.roadGeo=new s.bdM(8,this.segmentLength+.2),this.roadMat=new s._4j({map:this.dirtTexture,roughness:1,metalness:0,side:s.$EB}),this.grassGeo=new s.bdM(20,this.segmentLength+.2),this.grassMat=new s._4j({map:this.grassTexture,roughness:1,metalness:0,side:s.$EB}),this.fencePostGeo=new s.iNn(.2,1.2,.2),this.fenceRailGeo=new s.iNn(.1,.1,5),this.fenceMat=new s._4j({color:6111287,roughness:.9}),this.treeTrunkGeo=new s.Ho_(.2,.2,1,8),this.treeLeavesGeo=new s.qFE(1,2,8),this.treeMat=new s._4j({color:9127187}),this.leavesMat=new s._4j({color:2263842}),this.rockGeo=new s.nEu(.4),this.rockMat=new s._4j({color:8421504}));let i=new s.eaF(this.roadGeo,this.roadMat);i.rotation.x=-Math.PI/2,i.position.set(0,.01,0),t.add(i);let n=new s.eaF(this.grassGeo,this.grassMat);n.rotation.x=-Math.PI/2,n.position.set(-14,0,0),t.add(n);let a=new s.eaF(this.grassGeo,this.grassMat);a.rotation.x=-Math.PI/2,a.position.set(14,0,0),t.add(a);let o=new s.bdM(.4,.4),r=new s._4j({map:this.grassTexture,transparent:!0,alphaTest:.5,side:s.$EB}),l=Math.floor(this.segmentLength/2);for(let e=0;e<l;e++){let i=2*e-this.segmentLength/2+ +Math.random(),n=new s.eaF(o,r);n.rotation.x=-Math.PI/2,n.rotation.z=Math.random()*Math.PI,n.position.set(-1+(.2*Math.random()-.1),.02,i),t.add(n);let a=new s.eaF(o,r);a.rotation.x=-Math.PI/2,a.rotation.z=Math.random()*Math.PI,a.position.set(1+(.2*Math.random()-.1),.02,i),t.add(a)}for(let e=0;e<10;e++){let i=5*e-this.segmentLength/2,n=new s.eaF(this.fencePostGeo,this.fenceMat);n.position.set(-3.5,.5,i),t.add(n);let a=new s.eaF(this.fenceRailGeo,this.fenceMat);a.position.set(-3.5,.8,i+2.5),t.add(a);let o=new s.eaF(this.fenceRailGeo,this.fenceMat);o.position.set(-3.5,.4,i+2.5),t.add(o);let r=new s.eaF(this.fencePostGeo,this.fenceMat);r.position.set(3.5,.5,i),t.add(r);let l=new s.eaF(this.fenceRailGeo,this.fenceMat);l.position.set(3.5,.8,i+2.5),t.add(l);let h=new s.eaF(this.fenceRailGeo,this.fenceMat);h.position.set(3.5,.4,i+2.5),t.add(h)}let h=new s.iNn(.2,.2,.2),c=new s._4j({color:0xffff00}),d=new s._4j({color:0xff0000});for(let e=0;e<20;e++){let e=(10*Math.random()+6)*(Math.random()>.5?1:-1),i=Math.random()*this.segmentLength-this.segmentLength/2,n=Math.random();if(n<.2){let n=new s.eaF(this.treeTrunkGeo,this.treeMat);n.position.set(e,.5,i),t.add(n);let a=new s.eaF(this.treeLeavesGeo,this.leavesMat);a.position.set(e,1.5,i),t.add(a)}else if(n<.4){let n=new s.eaF(this.rockGeo,this.rockMat);n.position.set(e,.2,i),n.rotation.set(Math.random(),Math.random(),Math.random()),t.add(n)}else{let n=new s.eaF(h,Math.random()>.5?c:d);n.position.set(e,.1,i),t.add(n)}}t.position.z=e-this.segmentLength/2,t.position.y=0,this.game.scene.add(t),this.floorSegments.push(t)}spawnObstacle(e){let t,i=["crate","hay","rock"],s=i[Math.floor(Math.random()*i.length)];"crate"===s&&.2>Math.random()&&(s="double_crate"),Array.isArray(this.obstaclePool)&&(this.obstaclePool={crate:[],hay:[],rock:[],double_crate:[]}),this.obstaclePool[s]&&this.obstaclePool[s].length>0?(t=this.obstaclePool[s].pop()).visible=!0:t=this.createObstacleMesh(s);let n=Math.floor(3*Math.random())-1,a="rock"===s?.4:"double_crate"===s?1:.5;t.position.set(2*n,a,e),t.rotation.set(0,0,0),"rock"===s&&(t.rotation.y=Math.random()*Math.PI,t.rotation.x=Math.random()*Math.PI),this.obstacles.push(t)}createObstacleMesh(e){let t,i;if("crate"===e||"double_crate"===e){if(!this.crateTexture){let e=document.createElement("canvas");e.width=64,e.height=64;let t=e.getContext("2d");t.fillStyle="#8B4513",t.fillRect(0,0,64,64),t.strokeStyle="#5D4037",t.lineWidth=4,t.strokeRect(0,0,64,64),t.beginPath(),t.moveTo(0,0),t.lineTo(64,64),t.moveTo(64,0),t.lineTo(0,64),t.stroke(),this.crateTexture=new s.GOR(e),this.crateTexture.magFilter=s.hxR}if("crate"===e)t=new s.iNn(1,1,1),i=new s._4j({map:this.crateTexture,roughness:.8});else{t=new s.iNn(1,2,1);let e=this.crateTexture.clone();e.wrapT=s.GJx,e.repeat.set(1,2),i=new s._4j({map:e,roughness:.8})}}else if("hay"===e){if(!this.hayTexture){let e=document.createElement("canvas");e.width=64,e.height=64;let t=e.getContext("2d");t.fillStyle="#FFD700",t.fillRect(0,0,64,64),t.strokeStyle="#DAA520",t.lineWidth=2;for(let e=0;e<10;e++){let e=64*Math.random();t.beginPath(),t.moveTo(0,e),t.lineTo(64,e+(10*Math.random()-5)),t.stroke()}this.hayTexture=new s.GOR(e),this.hayTexture.magFilter=s.hxR}t=new s.iNn(1,1,1),i=new s._4j({map:this.hayTexture,roughness:1})}else if("rock"===e){if(!this.rockTexture){let e=document.createElement("canvas");e.width=64,e.height=64;let t=e.getContext("2d");t.fillStyle="#808080",t.fillRect(0,0,64,64);for(let e=0;e<100;e++)t.fillStyle=Math.random()>.5?"#696969":"#A9A9A9",t.fillRect(Math.floor(64*Math.random()),Math.floor(64*Math.random()),4,4);this.rockTexture=new s.GOR(e),this.rockTexture.magFilter=s.hxR}t=new s.nEu(.5),i=new s._4j({map:this.rockTexture,roughness:.9})}let n=new s.eaF(t,i);return n.userData.type=e,this.game.scene.add(n),n}spawnCoin(e){let t;if(this.coinPool.length>0)(t=this.coinPool.pop()).visible=!0,t.userData.isPopping=!1,t.scale.setScalar(1),t.material.opacity=1,t.material.transparent=!1;else{let e=new s.Ho_(.3,.3,.1,16),i=new s._4j({color:0xffd700,emissive:0xffaa00,emissiveIntensity:.5,metalness:.8,roughness:.2});(t=new s.eaF(e,i)).rotation.x=Math.PI/2,t.userData.initialRotX=Math.PI/2,this.game.scene.add(t)}let i=Math.floor(3*Math.random())-1;t.position.set(2*i,.5,e),t.rotation.set(Math.PI/2,0,0),t.userData.bobOffset=Math.random()*Math.PI*2,t.userData.imgScale=1,this.coins.push(t)}spawnJade(e){let t;if(this.jadePool.length>0)(t=this.jadePool.pop()).visible=!0;else{let e=new s.WBB(.4,0);this.jadeMaterial||(this.jadeMaterial=new s._4j({color:5025616,emissive:5025616,emissiveIntensity:.8,metalness:.8,roughness:.2})),t=new s.eaF(e,this.jadeMaterial),this.game.scene.add(t)}t.position.copy(e),t.position.y=.8,t.userData.bobOffset=1e3*Math.random(),t.rotation.set(Math.random(),Math.random(),Math.random()),this.jades.push(t)}checkJadeCollision(e){let t=0,i=new s.NRn().setFromObject(e);i.expandByScalar(-.1);for(let e=this.jades.length-1;e>=0;e--){let n=this.jades[e],a=new s.NRn().setFromObject(n);i.intersectsBox(a)&&(n.visible=!1,this.jadePool.push(n),this.jades.splice(e,1),t++)}return t}updateJadeGlow(e){this.jadeMaterial&&(this.jadeMaterial.emissiveIntensity=e)}update(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,s=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=t*e;for(let e=this.floorSegments.length-1;e>=0;e--){let t=this.floorSegments[e];if(t.position.z+=n,t.position.z>50){let e=0;this.floorSegments.forEach(t=>e=Math.min(e,t.position.z)),t.position.z=e-this.segmentLength;let i="bloodmoon"===this.game.weatherType?16:8,s=this.segmentLength/i;for(let e=0;e<i;e++){let i=t.position.z+e*s-this.segmentLength/2,n=Math.random();n<.45?this.spawnObstacle(i):n>.55&&this.spawnCoin(i)}}}if("none"!==this.game.weatherType){this.weatherParticles.visible=!0;let t=this.weatherParticles.geometry.attributes.position.array;for(let i=0;i<t.length;i+=3)"storm"===this.game.weatherType?(t[i+1]-=20*e,t[i+1]<0&&(t[i+1]=20),this.weatherParticles.material.color.set(0xaaaaaa)):"sandstorm"===this.game.weatherType?(t[i+1]-=2*e,t[i]-=10*e,t[i]<-20&&(t[i]=20),t[i+1]<0&&(t[i+1]=10),this.weatherParticles.material.color.set(9127187)):"bloodmoon"===this.game.weatherType&&(t[i+1]-=e,t[i+1]<0&&(t[i+1]=20),this.weatherParticles.material.color.set(0xff0000));this.weatherParticles.geometry.attributes.position.needsUpdate=!0,this.weatherParticles.position.set(0,0,this.game.player.mesh.position.z-10)}else this.weatherParticles.visible=!1;for(let e=this.obstacles.length-1;e>=0;e--){let t=this.obstacles[e];if(t.position.z+=n,t.position.z>10){t.visible=!1;let i=t.userData.type||"crate";this.obstaclePool[i]||(this.obstaclePool[i]=[]),this.obstaclePool[i].push(t),this.obstacles.splice(e,1)}}for(let t=this.jades.length-1;t>=0;t--){let a=this.jades[t];if(s&&i&&8>a.position.distanceTo(i.position)){let t=i.position.clone().sub(a.position).normalize();a.position.add(t.multiplyScalar(15*e))}a.position.z+=n,a.rotation.y+=3*e,a.position.y=.8+.1*Math.sin(.005*Date.now()+a.userData.bobOffset),a.position.z>10&&(a.visible=!1,this.jadePool.push(a),this.jades.splice(t,1))}for(let t=this.coins.length-1;t>=0;t--){let a=this.coins[t];if(a.userData.isPopping){a.userData.imgScale+=5*e,a.scale.setScalar(a.userData.imgScale),a.material.opacity-=3*e,a.position.z+=n,a.material.opacity<=0&&(a.visible=!1,a.userData.isPopping=!1,this.coinPool.push(a),this.coins.splice(t,1));continue}if(s&&i&&8>a.position.distanceTo(i.position)){let t=i.position.clone().sub(a.position).normalize();a.position.add(t.multiplyScalar(15*e))}a.position.z+=n,a.rotation.z+=2*e,a.position.y=.5+.1*Math.sin(.005*Date.now()+a.userData.bobOffset),a.position.z>10&&(a.visible=!1,this.coinPool.push(a),this.coins.splice(t,1))}for(let t=this.particles.length-1;t>=0;t--){let i=this.particles[t];i.position.add(i.userData.velocity.clone().multiplyScalar(e)),i.userData.velocity.y+=.5*this.game.player.gravity*e,i.userData.life-=e,i.material.opacity=i.userData.life,i.userData.life<=0&&(i.visible=!1,this.game.scene.remove(i),this.particlePool.push(i),this.particles.splice(t,1))}for(let t=this.decals.length-1;t>=0;t--){let i=this.decals[t];if(i.position.z+=n,void 0===i.userData.life&&(i.userData.life=2),i.userData.life-=e,i.userData.life<=0){let s=i.material;s.opacity-=2*e,s.opacity<=0&&(this.game.scene.remove(i),this.decals.splice(t,1))}else i.position.z>10&&(this.game.scene.remove(i),this.decals.splice(t,1))}}spawnBurnMark(e){if(!this.burnMarkTexture){let e=document.createElement("canvas");e.width=64,e.height=64;let t=e.getContext("2d");t.clearRect(0,0,64,64);let i=t.createRadialGradient(32,32,5,32,32,30);i.addColorStop(0,"rgba(0, 0, 0, 0.8)"),i.addColorStop(.5,"rgba(20, 20, 20, 0.6)"),i.addColorStop(1,"rgba(0, 0, 0, 0)"),t.fillStyle=i,t.beginPath();for(let e=0;e<8;e++){let i=e/8*Math.PI*2,s=20+12*Math.random(),n=32+Math.cos(i)*s,a=32+Math.sin(i)*s;0===e?t.moveTo(n,a):t.lineTo(n,a)}t.closePath(),t.fill(),this.burnMarkTexture=new s.GOR(e)}let t=new s.bdM(1.2,1.2),i=new s._4j({map:this.burnMarkTexture,transparent:!0,opacity:.7,depthWrite:!1,color:0}),n=new s.eaF(t,i);if(n.rotation.x=-Math.PI/2,n.position.set(e.x,.01,e.z),this.game.scene.add(n),this.decals.push(n),this.decals.length>20){let e=this.decals.shift();e&&this.game.scene.remove(e)}let a=n.position.clone();a.y=.2,this.spawnGenericParticles(a,2,3355443,.15,1,.5,!1)}clearNearbyObstacles(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;for(let t=this.obstacles.length-1;t>=0;t--){let i=this.obstacles[t];i.position.z<=0&&i.position.z>=-e&&this.breakObstacle(i)}}checkCollision(e){let t=new s.NRn().setFromObject(e);for(let e of(t.expandByScalar(-.2),this.obstacles)){let i=new s.NRn().setFromObject(e);if(i.expandByScalar(-.1),t.intersectsBox(i))return!0}return!1}checkCollisionDetailed(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=new s.NRn().setFromObject(e);i.expandByScalar(-.2+t);for(let e=this.obstacles.length-1;e>=0;e--){let t=this.obstacles[e],n=new s.NRn().setFromObject(t);if(n.expandByScalar(-.1),i.intersectsBox(n))return t}return null}breakObstacle(e){this.spawnShatterParticles(e.position,e.userData.type),e.visible=!1;let t=e.userData.type||"crate";this.obstaclePool[t]&&this.obstaclePool[t].push(e);let i=this.obstacles.indexOf(e);i>-1&&this.obstacles.splice(i,1)}spawnShatterParticles(e,t){let i=this.game.potionActive,s=i?20:10,n=i?.4:.2,a=i?12:8,o=9127187;"rock"===t||"stone"===t?o=8421504:"hay"===t&&(o=0xffd700),"double_crate"===t?this.spawnGenericParticles(e,2*s,o,n,a,1.2,!1):this.spawnGenericParticles(e,s,o,n,a,1.2,!1)}spawnGenericParticles(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.2,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:5,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,r=arguments.length>6&&void 0!==arguments[6]&&arguments[6];for(let l=0;l<t;l++){let t;if(this.particlePool.length>0){let e=(t=this.particlePool.pop()).material;e.color.set(i),e.emissive.setHex(r?"number"==typeof i?i:0xffffff:0),e.emissiveIntensity=+!!r,e.opacity=1,e.transparent=!0,t.visible=!0}else{let e=new s._4j({color:i,transparent:!0,emissive:r?i:0,emissiveIntensity:+!!r});t=new s.eaF(this.particleGeo,e)}t.scale.setScalar(n),t.position.copy(e),t.userData.velocity||(t.userData.velocity=new s.Pq0),t.userData.velocity.set((Math.random()-.5)*a,Math.random()*a*.5+.2*a,(Math.random()-.5)*a),t.userData.life=o,t.userData.maxLife=o,this.game.scene.add(t),this.particles.push(t)}}checkCoinCollision(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=new s.NRn().setFromObject(e);t>0&&i.expandByScalar(t);let n=0;for(let e=this.coins.length-1;e>=0;e--){let t=this.coins[e];if(t.userData.isPopping)continue;let a=new s.NRn().setFromObject(t);i.intersectsBox(a)&&(n++,t.userData.isPopping=!0,t.userData.imgScale=1,t.material=t.material.clone(),t.material.transparent=!0,t.material.opacity=1)}return n}constructor(e){this.jadePool=[],this.jades=[],this.decals=[],this.game=e,this.obstacles=[],this.coins=[],this.floorSegments=[],this.segmentLength=50,this.spawnDistance=100,this.lastSpawnZ=0,this.obstaclePool={crate:[],hay:[],rock:[],double_crate:[]},this.coinPool=[],this.particles=[],this.particlePool=[],this.init()}}class r{initQuests(){let e=new Date().toDateString(),t=localStorage.getItem("questDate");this.quests=[{id:"stones",title:"Break 20 Stones",goal:20,reward:50,type:"stones"},{id:"distance",title:"Reach 3,000m in one run",goal:3e3,reward:100,type:"distance"},{id:"jades",title:"Collect 5 Jades",goal:5,reward:150,type:"jades"}],t!==e?(this.questProgress={stones:0,distance:0,jades:0},localStorage.setItem("questDate",e),localStorage.setItem("questProgress",JSON.stringify(this.questProgress)),localStorage.setItem("questsClaimed",JSON.stringify({}))):this.questProgress=JSON.parse(localStorage.getItem("questProgress")||'{"stones": 0, "distance": 0, "jades": 0}'),this.questsClaimed=JSON.parse(localStorage.getItem("questsClaimed")||"{}")}init(){var e,t,i;this.bgm=new Audio("https://freetestdata.com/wp-content/uploads/2021/09/Free_Test_Data_1MB_MP3.mp3"),this.bgm.loop=!0,this.bgm.volume=.6*!this.isMuted,this.bgm.onerror=()=>console.error("Audio Source Missing: BGM"),this.menuBgm=new Audio("https://www.chosic.com/wp-content/uploads/2021/07/Country-Village.mp3"),this.menuBgm.loop=!0,this.menuBgm.volume=.6*!this.isMuted,this.menuBgm.onerror=()=>console.error("Audio Source Missing: Menu BGM"),this.thunderSfx=new Audio("https://www.soundjay.com/nature/sounds/thunder-crack-01.mp3"),this.thunderSfx.volume=.8,this.thunderSfx.onerror=()=>console.error("Audio Source Missing: Thunder SFX"),this.coinSfx=new Audio("https://www.soundjay.com/buttons/sounds/button-35.mp3"),this.coinSfx.volume=1,this.coinSfx.onerror=()=>console.error("Audio Source Missing: Coin SFX"),this.jumpSfx=new Audio("https://www.soundjay.com/buttons/sounds/button-27.mp3"),this.jumpSfx.volume=1,this.jumpSfx.preload="auto",this.jumpSfx.onerror=()=>{console.error("Audio Source Missing: Jump SFX"),this.playSfx("jump")},this.jadeSfx=new Audio("https://www.soundjay.com/buttons/sounds/button-09.mp3"),this.jadeSfx.volume=1,this.jadeSfx.preload="auto",this.jadeSfx.onerror=()=>{console.error("Audio Source Missing: Jade SFX"),this.playSfx("jade")},this.breakSfx=new Audio("https://www.soundjay.com/buttons/sounds/button-10.mp3"),this.breakSfx.volume=1,this.breakSfx.preload="auto",this.breakSfx.onerror=()=>{console.error("Audio Source Missing: Break SFX"),this.playSfx("break")};let r=()=>{let e=window.AudioContext||window.webkitAudioContext;if(e){let t=new e;"suspended"===t.state&&t.resume()}this.bgm.volume=0,this.menuBgm.volume=0,this.bgm.play().catch(()=>{}),this.menuBgm.play().catch(()=>{}),this.isPlaying?this.switchMusic("game"):this.switchMusic("menu"),this.updateMusicButtons(),window.removeEventListener("mousedown",r),window.removeEventListener("keydown",r),window.removeEventListener("touchstart",r)};window.addEventListener("mousedown",r),window.addEventListener("keydown",r),window.addEventListener("touchstart",r),document.getElementById("music-toggle-start").addEventListener("click",()=>this.toggleMusic()),document.getElementById("music-toggle-pause").addEventListener("click",()=>this.toggleMusic()),this.scene=new s.Z58,this.scene.fog=new s.cRK(8900331,.02),this.camera=new s.ubm(75,window.innerWidth/window.innerHeight,.1,100),this.camera.position.set(0,3,5),this.camera.lookAt(0,1,0),this.renderer=new n.JeP({antialias:!0}),this.renderer.setSize(window.innerWidth,window.innerHeight),this.renderer.setClearColor(8900331),document.body.appendChild(this.renderer.domElement),this.weatherOverlayEl=document.getElementById("weather-overlay"),this.ambientLight=new s.$p8(0xffffff,.6),this.scene.add(this.ambientLight),this.dirLight=new s.ZyN(0xffffff,1.5),this.dirLight.position.set(10,20,10),this.dirLight.castShadow=!0,this.scene.add(this.dirLight);let l=new s.Gu$(1.5,32,32),h=new s.V9B({color:0xffd700});this.sunMesh=new s.eaF(l,h),this.scene.add(this.sunMesh);let c=new s.Gu$(2.5,32,32),d=new s.V9B({color:0xffd700,transparent:!0,opacity:.2});this.sunFlare=new s.eaF(c,d),this.sunMesh.add(this.sunFlare);let m=new s.Gu$(1.2,32,32),u=new s.V9B({color:0xe0e0e0});this.moonMesh=new s.eaF(m,u),this.scene.add(this.moonMesh),this.createStars(),this.dayTime=0,this.player=new a(this),this.world=new o(this),window.addEventListener("resize",()=>this.onWindowResize()),this.startScreen=document.getElementById("start-screen"),this.gameOverScreen=document.getElementById("game-over-screen"),this.shopScreen=document.getElementById("shop-screen"),this.pausedScreen=document.getElementById("paused-screen"),this.bagScreen=document.getElementById("bag-screen"),this.bagItemsList=document.getElementById("bag-items-list"),this.guideScreen=document.getElementById("guide-screen"),this.notificationEl=document.getElementById("notification"),this.potionHudEl=document.getElementById("potion-hud"),this.potionChargesEl=document.getElementById("potion-charges"),this.hud=document.getElementById("hud"),this.runGoldValEl=document.getElementById("run-gold-val"),this.runGoldOverEl=document.getElementById("run-gold-over"),this.walletOverEl=document.getElementById("wallet-over"),this.highScoreOverEl=document.getElementById("high-score-over"),this.totalGoldHudEl=document.getElementById("total-gold-hud"),this.totalJadesHudEl=document.getElementById("total-jades-hud"),this.startGoldEl=document.getElementById("start-total-gold"),this.startJadesEl=document.getElementById("start-total-jades"),this.startHighScoreEl=document.getElementById("start-high-score"),this.startTotalDistEl=document.getElementById("start-total-dist"),this.shopGoldEl=document.getElementById("shop-gold"),this.shopJadesEl=document.getElementById("shop-jades"),this.btnBuyMagnet=document.getElementById("buy-magnet"),this.btnBuyPotion=document.getElementById("buy-potion"),this.magnetTimerEl=document.getElementById("magnet-timer"),this.magnetTimeLeftEl=document.getElementById("magnet-time-left"),this.reviveBtn=document.getElementById("revive-btn"),this.reviveCountdownEl=document.getElementById("revive-countdown"),this.reviveBtn.addEventListener("click",()=>this.revive()),document.getElementById("start-btn").addEventListener("click",()=>this.start()),document.getElementById("restart-btn").addEventListener("click",()=>this.start()),document.getElementById("resume-btn").addEventListener("click",()=>this.togglePause()),document.getElementById("menu-btn-pause").addEventListener("click",()=>this.goToMainMenu()),document.getElementById("menu-btn-over").addEventListener("click",()=>this.goToMainMenu()),this.jumpBtnMobile=document.getElementById("jump-btn-mobile"),this.quickMagnetBtn=document.getElementById("quick-magnet"),this.quickPotionBtn=document.getElementById("quick-potion"),this.distanceHudEl=document.getElementById("distance-hud"),this.distanceOverEl=document.getElementById("run-distance-over"),document.getElementById("touch-move-left").addEventListener("pointerdown",e=>{this.player.moveLeft()}),document.getElementById("touch-move-right").addEventListener("pointerdown",e=>{this.player.moveRight()}),null==(e=this.jumpBtnMobile)||e.addEventListener("pointerdown",e=>{e.preventDefault(),this.player.jump()}),null==(t=this.quickMagnetBtn)||t.addEventListener("pointerdown",e=>{e.preventDefault(),this.useItem("magnet")}),null==(i=this.quickPotionBtn)||i.addEventListener("pointerdown",e=>{e.preventDefault(),this.useItem("potion")}),document.getElementById("shop-btn-start").addEventListener("click",()=>this.openShop()),document.getElementById("shop-btn-over").addEventListener("click",()=>this.openShop()),this.questsScreen=document.getElementById("quests-screen"),this.questsListEl=document.getElementById("quests-list"),document.getElementById("quests-btn-start").addEventListener("click",()=>this.openQuests()),document.getElementById("close-quests-btn").addEventListener("click",()=>this.closeQuests()),document.getElementById("shop-btn-pause").addEventListener("click",()=>this.openShop()),document.getElementById("shop-back").addEventListener("click",()=>this.closeShop()),document.getElementById("bag-btn").addEventListener("click",()=>this.openBag()),document.getElementById("bag-close").addEventListener("click",()=>this.closeBag()),document.getElementById("guide-btn-start").addEventListener("click",()=>this.openGuide()),document.getElementById("guide-btn-pause").addEventListener("click",()=>this.openGuide()),document.getElementById("guide-close").addEventListener("click",()=>this.closeGuide()),this.btnBuyMagnet.addEventListener("click",()=>{this.totalGold>=30&&(this.totalGold-=30,this.inventory.magnet=(this.inventory.magnet||0)+1,this.saveData(),this.updateShopUI())}),this.btnBuyPotion.addEventListener("click",()=>{this.totalGold>=100&&(this.totalGold-=100,this.inventory.potion=(this.inventory.potion||0)+1,this.saveData(),this.updateShopUI())}),document.getElementById("mint-horseshoe").addEventListener("click",()=>this.mintHorseshoe());let p=document.getElementById("tab-store"),g=document.getElementById("tab-skins"),v=document.getElementById("tab-mint"),y=document.getElementById("store-content"),f=document.getElementById("skins-content"),S=document.getElementById("mint-content"),w=(e,t)=>{[p,g,v].forEach(e=>e.classList.remove("active")),[y,f,S].forEach(e=>e.classList.remove("active")),e.classList.add("active"),t.classList.add("active"),e===g&&this.renderSkinsShop()};p.addEventListener("click",()=>w(p,y)),g.addEventListener("click",()=>w(g,f)),v.addEventListener("click",()=>w(v,S)),window.addEventListener("keydown",e=>{"Digit1"===e.code&&this.useItem("magnet"),"Digit2"===e.code&&this.useItem("potion"),("KeyB"===e.code||"Escape"===e.code)&&(this.bagScreen.classList.contains("active")?this.closeBag():this.shopScreen.classList.contains("active")?this.closeShop():this.pausedScreen.classList.contains("active")?this.togglePause():this.openBag())}),this.updateStartUI();let b=document.getElementById("splash-screen"),E=document.getElementById("loading-bar-fill");if(b&&E){let e=0,t=setInterval(()=>{(e+=15*Math.random())>=100&&(e=100,clearInterval(t),setTimeout(()=>{b.style.opacity="0",setTimeout(()=>b.style.display="none",500)},500)),E.style.width=e+"%"},100)}}updateStartUI(){this.startGoldEl&&(this.startGoldEl.innerText=this.totalGold.toString()),this.startJadesEl&&(this.startJadesEl.innerText=this.totalJades.toString()),this.startHighScoreEl&&(this.startHighScoreEl.innerText=this.highScore.toString()),this.startTotalDistEl&&(this.startTotalDistEl.innerText=this.totalDistance.toString())}isUIOpen(){return this.shopScreen.classList.contains("active")||this.bagScreen.classList.contains("active")||this.guideScreen.classList.contains("active")||this.pausedScreen.classList.contains("active")||this.startScreen.classList.contains("active")||this.gameOverScreen.classList.contains("active")}useItem(e){if(this.isPlaying||this.bagScreen.classList.contains("active")){if("magnet"===e){if(this.magnetActive)return void this.showNotification("Item already active!");this.inventory.magnet>0&&(this.inventory.magnet--,this.activateMagnet(),this.saveData(),this.updateBagUI(),this.bagScreen.classList.contains("active")&&this.closeBag())}else if("potion"===e){if(this.potionActive)return void this.showNotification("Item already active!");this.inventory.potion>0&&(this.inventory.potion--,this.activatePotion(),this.saveData(),this.updateBagUI(),this.bagScreen.classList.contains("active")&&this.closeBag())}this.updateMobileControlsVisibility()}}activatePotion(e){this.potionActive=!0;let t=void 0!==e?e:20;void 0===e&&"Iron Knight"===this.equippedSkin&&(t+=3,this.showNotification("IRON KNIGHT BONUS: +3s Potion!")),this.potionTimer=t,this.player.setMetallicSkin(!0),this.potionHudEl.style.display="block",this.potionChargesEl.innerText=Math.ceil(this.potionTimer).toString(),this.showNotification("IRON BODY ACTIVATED!")}activateMagnet(){this.magnetActive=!0,this.magnetTimer=30,this.player.setMagnetEffect(!0),this.magnetTimerEl.style.display="block",this.showNotification("MAGNET ACTIVATED!")}showNotification(e){this.notificationEl&&(this.notificationEl.innerText=e,this.notificationEl.style.opacity="1",this.notificationEl.style.transform="translate(-50%, -200%)",setTimeout(()=>{this.notificationEl.style.opacity="0",this.notificationEl.style.transform="translate(-50%, -150%)"},2e3))}togglePause(){(this.isPlaying||this.pausedScreen.classList.contains("active"))&&(this.isPlaying?(this.isPlaying=!1,this.pausedScreen.style.display="block",setTimeout(()=>this.pausedScreen.classList.add("active"),10)):(this.isPlaying=!0,this.pausedScreen.classList.remove("active"),setTimeout(()=>this.pausedScreen.style.display="none",300)),this.updateMobileControlsVisibility())}saveData(){localStorage.setItem("totalGold",this.totalGold.toString()),localStorage.setItem("totalJades",this.totalJades.toString()),localStorage.setItem("totalDistance",this.totalDistance.toString()),localStorage.setItem("highScore",this.highScore.toString()),localStorage.setItem("inventory",JSON.stringify(this.inventory)),localStorage.setItem("hasHorseshoe",this.hasHorseshoe.toString()),localStorage.setItem("ownedSkins",JSON.stringify(this.ownedSkins)),localStorage.setItem("equippedSkin",this.equippedSkin)}goToMainMenu(){this.switchMusic("menu"),this.isPlaying=!1,this.gameIsOver=!1,this.setWeather("none"),this.player&&(this.player.mesh.visible=!0),this.potionHudEl&&(this.potionHudEl.style.display="none"),this.magnetTimerEl&&(this.magnetTimerEl.style.display="none"),this.dirLight.intensity=1.5,this.dirLight.color.setHex(0xffffff),this.ambientLight.intensity=.6,this.renderer.setClearColor(8900331),this.scene.fog.color.setHex(8900331),this.dayTime=0,this.stars&&(this.stars.material.opacity=0),this.sunMesh&&(this.sunMesh.visible=!0),this.moonMesh&&(this.moonMesh.visible=!1),this.world&&this.world.particles&&(this.world.particles.forEach(e=>this.scene.remove(e)),this.world.particles=[]),this.player&&(this.player.moltenPointLight&&(this.player.moltenPointLight.intensity=0),this.player.moltenHalo&&(this.player.moltenHalo.visible=!1)),this.pausedScreen.classList.remove("active"),this.gameOverScreen.classList.remove("active"),this.bagScreen.classList.remove("active"),this.hud.classList.add("hidden"),setTimeout(()=>{this.pausedScreen.style.display="none",this.gameOverScreen.style.display="none",this.bagScreen.style.display="none",this.startScreen.style.display="block",setTimeout(()=>this.startScreen.classList.add("active"),10),this.updateStartUI()},300)}openShop(){this.isPlaying=!1,"none"!==this.gameOverScreen.style.display&&this.gameOverScreen.classList.contains("active")?this.previousScreen=this.gameOverScreen:"none"!==this.pausedScreen.style.display&&this.pausedScreen.classList.contains("active")?this.previousScreen=this.pausedScreen:this.previousScreen=this.startScreen,this.previousScreen.classList.remove("active"),this.previousScreen.style.display="none",this.shopScreen.style.display="block",setTimeout(()=>this.shopScreen.classList.add("active"),10),this.updateShopUI()}closeShop(){this.shopScreen.classList.remove("active"),setTimeout(()=>{this.shopScreen.style.display="none",this.gameIsOver&&this.previousScreen===this.gameOverScreen?(this.gameOverScreen.style.display="block",this.walletOverEl.innerText=this.totalGold.toString(),setTimeout(()=>this.gameOverScreen.classList.add("active"),10),this.isPlaying=!1):this.previousScreen?(this.previousScreen.style.display="block",setTimeout(()=>this.previousScreen.classList.add("active"),10),this.isPlaying=this.previousScreen!==this.startScreen&&this.previousScreen!==this.pausedScreen&&this.previousScreen!==this.gameOverScreen):(this.startScreen.style.display="block",setTimeout(()=>this.startScreen.classList.add("active"),10),this.isPlaying=!1),this.updateStartUI(),this.updateMobileControlsVisibility()},300)}updateShopUI(){this.shopGoldEl.innerText=this.totalGold.toString(),this.shopJadesEl.innerText=this.totalJades.toString(),this.totalGoldHudEl&&(this.totalGoldHudEl.innerText=this.totalGold.toString()),this.totalJadesHudEl&&(this.totalJadesHudEl.innerText=this.totalJades.toString()),this.btnBuyMagnet.classList.remove("owned"),this.btnBuyMagnet.innerHTML="<div>Magnet</div><div style='font-size: 0.8rem; opacity: 0.9;'>Pulls all nearby Gold</div><div class='price'>30 G</div>",this.btnBuyMagnet.disabled=this.totalGold<30,this.btnBuyPotion.classList.remove("owned"),this.btnBuyPotion.innerHTML="<div>Iron Potion</div><div style='font-size: 0.8rem; opacity: 0.9;'>Smash through obstacles!</div><div class='price'>100 G</div>",this.btnBuyPotion.disabled=this.totalGold<100;let e=document.getElementById("mint-horseshoe");this.hasHorseshoe?(e.classList.add("owned"),e.innerHTML="<div style='font-size: 2.5rem;'>\uD83D\uDC5F</div><div>Horse Shoe</div><div class='price'>NFT VERIFIED</div>",e.disabled=!0):(e.innerHTML="<div style='font-size: 2.5rem;'>\uD83D\uDC5F</div><div>Horse Shoe</div><div class='price'>MINT (1000G + 100J)</div>",e.disabled=this.totalGold<1e3||this.totalJades<100),this.updateMobileControlsVisibility()}updateMobileControlsVisibility(){this.jumpBtnMobile&&(this.jumpBtnMobile.style.display=this.isPlaying?"flex":"none"),this.isPlaying?(this.inventory.magnet>0?(this.quickMagnetBtn.style.display="flex",this.quickMagnetBtn.querySelector(".count").innerText="x".concat(this.inventory.magnet)):this.quickMagnetBtn.style.display="none",this.inventory.potion>0?(this.quickPotionBtn.style.display="flex",this.quickPotionBtn.querySelector(".count").innerText="x".concat(this.inventory.potion)):this.quickPotionBtn.style.display="none"):(this.quickMagnetBtn.style.display="none",this.quickPotionBtn.style.display="none")}mintHorseshoe(){if(this.totalGold>=1e3&&this.totalJades>=100&&!this.hasHorseshoe){this.totalGold-=1e3,this.totalJades-=100,this.hasHorseshoe=!0,this.saveData();let e=document.getElementById("mint-horseshoe");e.classList.add("mint-glow"),setTimeout(()=>e.classList.remove("mint-glow"),1e3),this.updateShopUI(),this.showNotification("NFT MINTED: Horse Shoe Collected!"),this.player&&this.player.updateCosmetic()}}renderSkinsShop(){let e=document.getElementById("skins-list");e.innerHTML="",this.skinsData.forEach(t=>{let i=document.createElement("button");i.className="item-btn","Molten Core"===t.name&&i.classList.add("molten-border");let s=document.createElement("div");s.style.width="40px",s.style.height="40px",s.style.borderRadius="50%",s.style.backgroundColor=t.color,s.style.marginBottom="5px",s.style.border="2px solid #fff","Golden Dash"===t.name&&(s.style.boxShadow="0 0 10px #FFD700, inset 0 0 10px #FFFFFF",s.classList.add("golden-glint"));let n=document.createElement("div");n.innerText=t.name;let a=document.createElement("div");a.className="price";let o=this.ownedSkins.includes(t.name);this.equippedSkin===t.name?(i.classList.add("owned"),a.innerText="EQUIPPED",i.disabled=!0):o?(a.innerText="OWNED",i.onclick=()=>this.equipSkin(t.name)):("gold"===t.currency?(a.innerHTML="".concat(t.price," G"),this.totalGold<t.price&&(i.disabled=!0)):(a.innerHTML='<span style="color:#4CAF50">'.concat(t.price," J</span>"),this.totalJades<t.price&&(i.disabled=!0)),i.onclick=()=>this.buySkin(t));let r=document.createElement("div");r.style.fontSize="0.7rem",r.style.opacity="0.7",r.innerText=t.desc||"",i.appendChild(s),i.appendChild(n),i.appendChild(r),i.appendChild(a),e.appendChild(i)})}buySkin(e){"gold"===e.currency?this.totalGold>=e.price&&(this.totalGold-=e.price,this.completeSkinPurchase(e.name)):this.totalJades>=e.price&&(this.totalJades-=e.price,this.completeSkinPurchase(e.name))}completeSkinPurchase(e){this.ownedSkins.push(e),this.showNotification("SKIN UNLOCKED!"),this.saveData(),this.updateShopUI(),this.renderSkinsShop()}equipSkin(e){this.equippedSkin=e,this.saveData(),this.player.setSkin(e),this.renderSkinsShop(),this.showNotification("EQUIPPED!")}openBag(){this.bagScreen.classList.contains("active")||(this.wasPlayingBeforeBag=this.isPlaying,this.isPlaying=!1,"none"!==this.gameOverScreen.style.display&&this.gameOverScreen.classList.contains("active")?this.previousBagScreen=this.gameOverScreen:"none"!==this.startScreen.style.display&&this.startScreen.classList.contains("active")?this.previousBagScreen=this.startScreen:"none"!==this.pausedScreen.style.display&&this.pausedScreen.classList.contains("active")?this.previousBagScreen=this.pausedScreen:this.previousBagScreen=null,this.previousBagScreen&&(this.previousBagScreen.classList.remove("active"),setTimeout(()=>this.previousBagScreen.style.display="none",300)),this.bagScreen.style.display="block",setTimeout(()=>this.bagScreen.classList.add("active"),10),this.updateBagUI())}closeBag(){this.bagScreen.classList.remove("active"),setTimeout(()=>{this.bagScreen.style.display="none",this.previousBagScreen?(this.previousBagScreen.style.display="block",setTimeout(()=>this.previousBagScreen.classList.add("active"),10),this.isPlaying=!1):this.isPlaying=this.wasPlayingBeforeBag,this.updateMobileControlsVisibility()},300)}updateBagUI(){if(this.bagItemsList.innerHTML="",this.inventory.magnet>0){let e=document.createElement("button");e.className="item-btn",e.innerHTML='\n                <div style="font-size: 2rem;">\uD83E\uDDF2</div>\n                <div>Magnet (30s)</div>\n                <div class="item-count">x'.concat(this.inventory.magnet,'</div>\n                <div class="price">USE</div>\n            '),e.onclick=()=>{this.useItem("magnet")},this.bagItemsList.appendChild(e)}if(this.inventory.potion>0){let e=document.createElement("button");e.className="item-btn",e.innerHTML='\n                <div style="font-size: 2rem;">\uD83E\uDDEA</div>\n                <div>Iron Potion</div>\n                <div class="item-count">x'.concat(this.inventory.potion,'</div>\n                <div class="price">USE</div>\n            '),e.onclick=()=>{this.useItem("potion")},this.bagItemsList.appendChild(e)}if(this.hasHorseshoe){let e=document.createElement("div");e.className="item-btn owned",e.style.borderColor="#FFD700",e.innerHTML='\n                <div style="font-size: 2rem;">\uD83D\uDC5F</div>\n                <div>Horse Shoe</div>\n                <div style="font-size: 0.8rem; color: #FFD700; margin-top: 5px; font-weight: bold;">NFT VERIFIED</div>\n                <div class="price" style="color: #fff;">EQUIPPED</div>\n            ',this.bagItemsList.appendChild(e)}if(""===this.bagItemsList.innerHTML&&(this.bagItemsList.innerHTML="<p>Your bag is empty!</p>"),document.createElement("div").style.marginTop="20px",!this.previousBagScreen&&!this.gameIsOver){let e=document.createElement("button");e.innerText="Quit to Menu",e.style.fontSize="1.5rem",e.style.marginRight="10px",e.onclick=()=>{this.bagScreen.classList.remove("active"),setTimeout(()=>{this.bagScreen.style.display="none",this.isPlaying=!1,this.hud.classList.add("hidden"),this.startScreen.style.display="block",setTimeout(()=>this.startScreen.classList.add("active"),10)},300)},this.bagItemsList.appendChild(e)}}start(){this.switchMusic("game"),this.isPlaying=!0,this.gameIsOver=!1,this.runCoins=0,this.runDistance=0,this.reviveCount=0,this.reviveInterval&&(clearInterval(this.reviveInterval),this.reviveInterval=null),document.getElementById("revive-container").style.display="none",this.distanceHudEl.innerText="0000m",this.runGoldValEl.innerText="0",this.speed=10,"Neon Runner"===this.equippedSkin&&(this.speed*=1.15),this.speedTimer=0,this.clock.start(),this.dayTime=0,this.setWeather("none"),this.player.reset(),this.magnetActive=!1,this.player.setMagnetEffect(!1),this.magnetTimerEl.style.display="none",this.potionActive=!1,this.potionTimer=0,this.player.setMetallicSkin(!1),this.potionHudEl.style.display="none",this.world.reset(),this.totalGoldHudEl&&(this.totalGoldHudEl.innerText=this.totalGold.toString()),this.totalJadesHudEl&&(this.totalJadesHudEl.innerText=this.totalJades.toString()),this.player&&this.player.updateCosmetic(),this.updateMobileControlsVisibility(),this.startScreen.style.display="none",this.shopScreen.classList.remove("active"),this.shopScreen.style.display="none",this.startScreen.classList.remove("active"),this.gameOverScreen.classList.remove("active"),setTimeout(()=>{this.startScreen.style.display="none",this.gameOverScreen.style.display="none"},300),this.hud.classList.remove("hidden"),this.animationId||this.animate()}openGuide(){this.isPlaying=!1,"none"!==this.pausedScreen.style.display&&this.pausedScreen.classList.contains("active")?this.previousGuideScreen=this.pausedScreen:"none"!==this.startScreen.style.display&&this.startScreen.classList.contains("active")?this.previousGuideScreen=this.startScreen:this.previousGuideScreen=null,this.previousGuideScreen&&(this.previousGuideScreen.classList.remove("active"),setTimeout(()=>this.previousGuideScreen.style.display="none",300)),this.guideScreen.style.display="block",setTimeout(()=>this.guideScreen.classList.add("active"),10)}closeGuide(){this.guideScreen.classList.remove("active"),setTimeout(()=>{this.guideScreen.style.display="none",this.previousGuideScreen?(this.previousGuideScreen.style.display="block",setTimeout(()=>this.previousGuideScreen.classList.add("active"),10),this.isPlaying=!1):this.isPlaying=!0},300)}gameOver(){this.switchMusic("menu"),this.isPlaying=!1,this.gameIsOver=!0,this.clock.stop();let e=Math.floor(this.runDistance);e>this.highScore&&(this.highScore=e,this.showNotification("NEW PERSONAL BEST!")),this.totalGold+=this.runCoins,this.totalDistance+=e,this.saveData(),this.totalGoldHudEl&&(this.totalGoldHudEl.innerText=this.totalGold.toString()),this.distanceOverEl.innerText=e.toString(),this.runGoldOverEl.innerText=this.runCoins.toString(),this.walletOverEl.innerText=this.totalGold.toString(),this.highScoreOverEl.innerText=this.highScore.toString(),this.reviveCount<3?(document.getElementById("revive-container").style.display="block",this.reviveTimer=10,this.updateReviveUI(),this.reviveInterval&&clearInterval(this.reviveInterval),this.reviveInterval=setInterval(()=>{this.reviveTimer--,this.updateReviveUI(),this.reviveTimer<=0&&(clearInterval(this.reviveInterval),this.reviveInterval=null,document.getElementById("revive-container").style.display="none")},1e3)):document.getElementById("revive-container").style.display="none",this.gameOverScreen.style.display="block",setTimeout(()=>this.gameOverScreen.classList.add("active"),10),this.hud.classList.add("hidden")}getReviveCost(){return 0===this.reviveCount?100:1===this.reviveCount?250:500}updateReviveUI(){if(!this.reviveBtn||!this.reviveCountdownEl)return;let e=this.getReviveCost();this.reviveCountdownEl.innerText=this.reviveTimer.toString(),this.reviveBtn.innerHTML="<div>REVIVE NOW</div><div class='price' style='font-size: 1rem;'>".concat(e," G</div>"),this.reviveBtn.disabled=this.totalGold<e,this.totalGold<e?(this.reviveBtn.style.background="#555",this.reviveBtn.style.opacity="0.5",this.reviveBtn.style.cursor="not-allowed"):(this.reviveBtn.style.background="#4CAF50",this.reviveBtn.style.opacity="1",this.reviveBtn.style.cursor="pointer")}revive(){let e=this.getReviveCost();if(this.totalGold>=e&&this.reviveCount<3){this.totalGold-=e,this.reviveCount++,this.saveData(),this.reviveInterval&&(clearInterval(this.reviveInterval),this.reviveInterval=null);let t=window.AudioContext||window.webkitAudioContext;if(t){let e=new t;"suspended"===e.state&&e.resume()}this.switchMusic("game"),this.isPlaying=!0,this.gameIsOver=!1,this.clock.start(),this.world.clearNearbyObstacles(40),this.activatePotion(4),this.gameOverScreen.classList.remove("active"),setTimeout(()=>{this.gameOverScreen.style.display="none",this.hud.classList.remove("hidden")},300),this.updateStartUI(),this.totalGoldHudEl&&(this.totalGoldHudEl.innerText=this.totalGold.toString()),this.showNotification("REVIVED! 4s INVINCIBILITY!")}}update(e){let t;if(!this.isPlaying)return;this.speedTimer+=e,this.speedTimer>=10&&(this.speed*=1.05,this.speedTimer-=10);let i=Math.floor(this.runDistance);this.runDistance+=this.speed*e;let n=Math.floor(this.runDistance);this.distanceHudEl.innerText=n.toString().padStart(4,"0")+"m",n>this.questProgress.distance&&this.updateQuestProgress("distance",n,!0),Math.floor(n/500)>Math.floor(i/500)&&this.showNotification("SPEED UP! "),this.magnetActive&&(this.magnetTimer-=e,this.magnetTimer<=0?(this.magnetActive=!1,this.magnetTimer=0,this.player.setMagnetEffect(!1),this.magnetTimerEl.style.display="none"):this.magnetTimeLeftEl.innerText=Math.ceil(this.magnetTimer).toString()),this.potionActive&&(this.potionTimer-=e,this.potionTimer<=0?(this.potionActive=!1,this.potionTimer=0,this.player.setMetallicSkin(!1),this.player.mesh.visible=!0,this.potionHudEl.style.display="none",this.showNotification("IRON BODY ENDED")):this.potionChargesEl.innerText=Math.ceil(this.potionTimer).toString()),this.dayTime+=e;let a=this.dayTime%180/180,o=new s.Q1f(8900331),r=new s.Q1f(0xff8c00),l=new s.Q1f(48),h=0,c=1.5,d=new s.Q1f(0xffffff),m=.6,u=.8,p=a*Math.PI*2,g=30*Math.cos(p),v=15*Math.sin(p);this.sunMesh.position.set(g,v,-20);let y=p+Math.PI;this.moonMesh.position.set(30*Math.cos(y),15*Math.sin(y),-20);let f=105/180,S=105/180,w=120/180,b=165/180;if(a<.5)t=o,h=0,c=1.5,m=.6,u=.8,this.sunMesh.visible=!0,this.moonMesh.visible=!1,this.sunFlare.visible=!0,this.sunFlare.scale.setScalar(1.5+.1*Math.sin(.002*Date.now())),this.sunFlare.material.opacity=.15;else if(a<f){let e=(a-.5)/(f-.5);t=o.clone().lerp(r,e),h=.3*e,c=1.5-.5*e,m=.6-.2*e,u=.8+.7*e,this.sunMesh.visible=!0,this.moonMesh.visible=!0,this.sunFlare.visible=!0,this.sunFlare.material.opacity=.15*(1-e)}else if(a<b)t=a<w?r.clone().lerp(l,(a-S)/(w-S)):l,h=1,c=.2,m=.1,d=new s.Q1f(8947967),u=2,this.sunMesh.visible=!1,this.moonMesh.visible=!0,this.sunFlare.visible=!1;else{let e=(a-b)/(1-b);t=l.clone().lerp(o,e),h=1-e,c=.2+1.3*e,m=.1+.5*e,u=2-1.2*e,this.sunMesh.visible=e>.5,this.moonMesh.visible=e<.5,this.sunFlare.visible=!1}if(this.scene.fog.color.copy(t),this.renderer.setClearColor(t),this.stars.material.opacity=h,this.dirLight.intensity=c,this.dirLight.color.copy(d),this.dirLight.position.copy(this.sunMesh.position),this.ambientLight.intensity=m,this.world.updateJadeGlow(u),this.player.update(e,this.speed),this.world.update(e,this.speed,this.player.mesh,this.magnetActive),this.runDistance>2e3&&(this.weatherCycleTimer-=e,this.weatherCycleTimer<=0))if(this.weatherCycleTimer=30,"none"===this.weatherType){let e=Math.random();e<.33?this.setWeather("storm"):e<.66?this.setWeather("sandstorm"):this.setWeather("bloodmoon")}else this.setWeather("none");"none"!==this.weatherType&&this.updateWeather(e);let E=this.world.checkJadeCollision(this.player.mesh);if(E>0)for(let e=0;e<E;e++)this.onCollectJade(this.player.mesh.position);let M=4*!!this.magnetActive;"Golden Dash"===this.equippedSkin&&(M+=.5);let T=this.world.checkCoinCollision(this.player.mesh,M);"bloodmoon"===this.weatherType&&(T*=2),"Golden Dash"===this.equippedSkin&&T>0&&(T*=5),this.hasHorseshoe&&T>0&&(T=Math.round(1.25*T)),T>0&&this.onCollectGold(T);let I=0;"Molten Core"===this.equippedSkin&&this.potionActive&&(I=1);let x=this.world.checkCollisionDetailed(this.player.mesh,I);if(x)if(this.potionActive){let e=.1;"rock"===x.userData.type&&(e=.4),"double_crate"===x.userData.type&&(e=.5),this.triggerCameraShake(e,.15,60),this.onBreakObstacle(x),"rock"===x.userData.type&&this.updateQuestProgress("stones",1),this.checkJadeDrop(x.position),"Molten Core"===this.equippedSkin&&(this.moltenObstacleCount++,this.moltenObstacleCount>=10&&(this.totalJades+=5,this.saveData(),this.moltenObstacleCount=0,this.totalJadesHudEl&&(this.totalJadesHudEl.innerText=this.totalJades.toString())))}else this.gameOver()}checkJadeDrop(e){.65>Math.random()&&this.world.spawnJade(e)}onCollectGold(e){this.runCoins+=e,this.runGoldValEl.innerText=this.runCoins.toString();for(let t=0;t<e;t++)this.playSfx("coin");this.hud.classList.add("pop"),setTimeout(()=>this.hud.classList.remove("pop"),100)}onCollectJade(e){this.totalJades++,this.playSfx("jade"),this.updateQuestProgress("jades",1),this.saveData(),this.showFloatingText("+1 JADE",e,"#4CAF50"),this.totalJadesHudEl&&(this.totalJadesHudEl.innerText=this.totalJades.toString())}onBreakObstacle(e){this.playSfx("break"),this.world.breakObstacle(e)}setWeather(e){switch(this.weatherType=e,this.weatherTimer=30,this.weatherOverlayEl&&(this.weatherOverlayEl.style.background="transparent"),this.currentBgm&&(this.currentBgm.playbackRate=1),this.moonMesh.material.color.set(0xe0e0e0),this.moonMesh.scale.setScalar(1),e){case"storm":this.weatherOverlayEl&&(this.weatherOverlayEl.style.background="rgba(0, 0, 50, 0.4)"),this.currentBgm&&(this.currentBgm.playbackRate=.9);break;case"sandstorm":this.weatherOverlayEl&&(this.weatherOverlayEl.style.background="rgba(139, 69, 19, 0.4)"),this.currentBgm&&(this.currentBgm.playbackRate=.95);break;case"bloodmoon":this.weatherOverlayEl&&(this.weatherOverlayEl.style.background="rgba(139, 0, 0, 0.4)"),this.currentBgm&&(this.currentBgm.playbackRate=.85),this.moonMesh.material.color.set(0xff0000),this.moonMesh.scale.setScalar(3)}this.showNotification("EXTREME WEATHER: ".concat("none"===e?"NORMAL":e.toUpperCase()))}updateWeather(e){this.weatherTimer-=e,this.weatherTimer,"storm"===this.weatherType&&(this.lightningTimer-=e,this.lightningTimer<=0&&(this.lightningTimer=3+5*Math.random(),this.weatherOverlayEl&&(this.weatherOverlayEl.style.background="rgba(255, 255, 255, 0.8)"),this.triggerCameraShake(1,.5,10),this.thunderSfx&&this.thunderSfx.play().catch(()=>{}),setTimeout(()=>{"storm"===this.weatherType&&this.weatherOverlayEl&&(this.weatherOverlayEl.style.background="rgba(0, 0, 50, 0.4)")},100)))}showFloatingText(e,t,i){let s=document.createElement("div");s.innerText=e,s.style.position="absolute",s.style.color=i,s.style.fontWeight="bold",s.style.fontSize="24px",s.style.pointerEvents="none",s.style.textShadow="0 0 10px "+i,s.style.transition="all 1s ease-out",s.style.zIndex="1000",s.style.fontFamily="Arial, sans-serif";let n=t.clone();n.project(this.camera);let a=(.5*n.x+.5)*window.innerWidth,o=(-(.5*n.y)+.5)*window.innerHeight;s.style.left="".concat(a,"px"),s.style.top="".concat(o,"px"),document.body.appendChild(s),requestAnimationFrame(()=>{s.style.transform="translateY(-100px)",s.style.opacity="0"}),setTimeout(()=>{s.remove()},1e3)}triggerCameraShake(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;if(this.shakeTime>.05){this.shakeTime=Math.min(this.shakeTime+.05,.3),this.shakeIntensity=Math.min(this.MAX_SHAKE_INTENSITY,Math.max(this.shakeIntensity,e));return}this.shakeTime=t,this.shakeIntensity=Math.min(this.MAX_SHAKE_INTENSITY,e),this.shakeFrequency=i}hitStop(e){this.isHitStopping=!0,setTimeout(()=>{this.isHitStopping=!1},1e3*e)}createStars(){let e=new s.LoY,t=new Float32Array(1500);for(let e=0;e<1500;e++)t[e]=(Math.random()-.5)*100;e.setAttribute("position",new s.THS(t,3));let i=new s.BH$({size:.3,color:0xffffff,transparent:!0,opacity:0,sizeAttenuation:!0});this.stars=new s.ONl(e,i),this.stars.position.y=20,this.scene.add(this.stars)}animate(){this.animationId=requestAnimationFrame(()=>this.animate());try{if(this.isPlaying&&!this.isHitStopping){let e=this.clock.getDelta();this.update(e)}else this.clock.getDelta();if(this.shakeTime>0){this.shakeTime-=.016;let e=Math.min(1,this.shakeTime/.2),t=this.shakeIntensity*e,i=.001*Date.now()*this.shakeFrequency;this.camera.position.x=this.cameraBasePos.x+Math.sin(i)*t,this.camera.position.y=this.cameraBasePos.y+Math.cos(1.1*i)*t}else this.camera.position.copy(this.cameraBasePos);this.renderer.render(this.scene,this.camera)}catch(e){console.error("Game Loop Error:",e),this.isPlaying=!1,this.animationId&&cancelAnimationFrame(this.animationId),alert("A critical error occurred. The game has been paused/reset.\nError: "+e),this.goToMainMenu()}}onWindowResize(){this.camera.aspect=window.innerWidth/window.innerHeight,this.camera.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight)}updateQuestProgress(e,t){let i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];i?t>this.questProgress[e]&&(this.questProgress[e]=t):this.questProgress[e]=(this.questProgress[e]||0)+t;let s=this.quests.find(t=>t.type===e);s&&this.questProgress[e]>s.goal&&(this.questProgress[e]=s.goal),localStorage.setItem("questProgress",JSON.stringify(this.questProgress)),this.questsScreen&&this.questsScreen.classList.contains("active")&&this.renderQuests()}openQuests(){this.renderQuests(),this.questsScreen.style.display="block",setTimeout(()=>this.questsScreen.classList.add("active"),10)}closeQuests(){this.questsScreen.classList.remove("active"),setTimeout(()=>this.questsScreen.style.display="none",300)}renderQuests(){this.questsListEl&&(this.questsListEl.innerHTML="",this.quests.forEach(e=>{let t=this.questProgress[e.type]||0,i=t>=e.goal,s=this.questsClaimed[e.id],n=document.createElement("div");n.className="quest-item ".concat(i?"completed":"");let a=Math.min(100,t/e.goal*100);n.innerHTML='\n                <div class="quest-title">'.concat(e.title,'</div>\n                <div style="font-size: 0.9rem; color: #aaa;">Progress: ').concat(t," / ").concat(e.goal,'</div>\n                <div class="progress-container">\n                    <div class="progress-fill" style="width: ').concat(a,'%"></div>\n                </div>\n                <div class="quest-footer">\n                    <div class="reward-info">Reward: <span class="coin-icon"></span>').concat(e.reward,'G</div>\n                    <button class="claim-btn" ').concat(!i||s?"disabled":"",">\n                        ").concat(s?"DONE":i?"CLAIM":"LOCKED","\n                    </button>\n                </div>\n            "),i&&!s&&(n.querySelector(".claim-btn").onclick=()=>this.claimQuest(e.id)),this.questsListEl.appendChild(n)}))}claimQuest(e){let t=this.quests.find(t=>t.id===e);t&&!this.questsClaimed[e]&&(this.questProgress[t.type]||0)>=t.goal&&(this.totalGold+=t.reward,this.questsClaimed[e]=!0,localStorage.setItem("questsClaimed",JSON.stringify(this.questsClaimed)),this.saveData(),this.updateStartUI(),this.totalGoldHudEl&&(this.totalGoldHudEl.innerText=this.totalGold.toString()),this.showNotification("CLAIMED ".concat(t.reward," GOLD!")),this.renderQuests())}switchMusic(e){let t="menu"===e?this.menuBgm:this.bgm,i="menu"===e?this.bgm:this.menuBgm;if(this.currentBgm===t)return;this.currentBgm=t,this.bgm&&this.menuBgm&&(this.bgm.play().catch(()=>{}),this.menuBgm.play().catch(()=>{}));let s=.6*!this.isMuted;this.fadeCross(t,i,s),this.updateMusicButtons()}playSfx(e){if(this.isMuted)return;let t=null,i=440;"coin"===e?(t=this.coinSfx,i=880):"jump"===e?(t=this.jumpSfx,i=660):"jade"===e?(t=this.jadeSfx,i=1200):"break"===e&&(t=this.breakSfx,i=220);let s=()=>{try{let e=new(window.AudioContext||window.webkitAudioContext);"suspended"===e.state&&e.resume();let t=e.createOscillator(),s=e.createGain();t.type="sine",t.frequency.setValueAtTime(i,e.currentTime),s.gain.setValueAtTime(.1,e.currentTime),s.gain.exponentialRampToValueAtTime(.01,e.currentTime+.1),t.connect(s),s.connect(e.destination),t.start(),t.stop(e.currentTime+.1)}catch(e){console.warn("Synth Fallback Failed")}};if(t&&t.readyState>=2){let i=t.cloneNode();i.volume=t.volume,i.play().catch(t=>{console.warn("".concat(e," File failed, playing synth fallback")),s()})}else s()}toggleMusic(){this.isMuted=!this.isMuted,localStorage.setItem("isMuted",this.isMuted.toString());let e=.6*!this.isMuted;if(this.currentBgm){let t=this.currentBgm===this.bgm?this.menuBgm:this.bgm;this.fadeCross(this.currentBgm,t,e)}this.updateMusicButtons()}fadeCross(e,t,i){this.musicFadeInterval&&clearInterval(this.musicFadeInterval),this.musicFadeInterval=setInterval(()=>{e.volume<i?e.volume=Math.min(e.volume+.05,i):e.volume>i&&(e.volume=Math.max(e.volume-.05,i)),t.volume>0&&(t.volume=Math.max(t.volume-.05,0));let s=.01>Math.abs(e.volume-i),n=0===t.volume;s&&n&&(e.volume=i,t.volume=0,clearInterval(this.musicFadeInterval),this.musicFadeInterval=null)},50)}updateMusicButtons(){let e=this.isMuted?"\uD83D\uDD07":"\uD83D\uDD0A",t=document.getElementById("music-toggle-start"),i=document.getElementById("music-toggle-pause");t&&(t.innerText=e),i&&(i.innerText=e)}constructor(){this.animationId=null,this.clock=new s.zD7,this.isPlaying=!1,this.runCoins=0,this.runDistance=0,this.totalGold=0,this.totalJades=0,this.totalDistance=0,this.hasMagnet=!1,this.potionActive=!1,this.potionTimer=0,this.hasUnlockedJump=!0,this.hasHorseshoe=!1,this.ownedSkins=[],this.equippedSkin="Classic Farmer",this.magnetActive=!1,this.magnetTimer=0,this.highScore=0,this.skinsData=[{name:"Classic Farmer",price:0,currency:"gold",color:"#D2691E",desc:"A humble start."},{name:"Iron Knight",price:150,currency:"gold",color:"#708090",desc:"Iron Body Potion lasts 3s longer."},{name:"Neon Runner",price:10,currency:"jades",color:"#00FF00",desc:"+15% Base Speed."},{name:"Golden Dash",price:500,currency:"gold",color:"#FFD700",desc:"5x Gold Collection!"},{name:"Molten Core",price:50,currency:"jades",color:"#FF4500",desc:"Supernova Dash & Bonus Jades!"}],this.moltenObstacleCount=0,this.speed=10,this.speedTimer=0,this.gameIsOver=!1,this.cameraBasePos=new s.Pq0(0,3,5),this.shakeTime=0,this.shakeIntensity=0,this.shakeFrequency=60,this.MAX_SHAKE_INTENSITY=1,this.isHitStopping=!1,this.dayTime=0,this.previousScreen=null,this.previousBagScreen=null,this.previousGuideScreen=null,this.wasPlayingBeforeBag=!1,this.reviveCount=0,this.reviveTimer=0,this.reviveInterval=null,this.quests=[],this.questProgress={},this.currentBgm=null,this.isMuted=!1,this.musicFadeInterval=null,this.questsClaimed={},this.weatherType="none",this.weatherTimer=0,this.weatherCycleTimer=30,this.lightningTimer=0,console.log("%cTesting Mode Active: Press G for Gold, L for Items/Jump, Reset Button in Shop","color: #00ffff; font-weight: bold; font-size: 1.2rem;"),this.totalGold=parseInt(localStorage.getItem("totalGold")||"0"),this.totalJades=parseInt(localStorage.getItem("totalJades")||"0"),this.totalDistance=parseInt(localStorage.getItem("totalDistance")||"0"),this.highScore=parseInt(localStorage.getItem("highScore")||"0"),this.inventory=JSON.parse(localStorage.getItem("inventory")||'{"magnet": 0, "potion": 0}'),this.hasUnlockedJump=!0,this.hasHorseshoe="true"===localStorage.getItem("hasHorseshoe"),this.isMuted="true"===localStorage.getItem("isMuted"),this.ownedSkins=JSON.parse(localStorage.getItem("ownedSkins")||JSON.stringify(["Classic Farmer"])),this.equippedSkin=localStorage.getItem("equippedSkin")||"Classic Farmer",this.initQuests()}}var l=i(662);(async()=>{try{await l.xh.actions.ready(),console.log("Farcaster SDK Ready"),new r().init()}catch(i){console.error("Game Initialization Failed:",i);let e=document.createElement("div");e.style.position="fixed",e.style.top="10px",e.style.left="10px",e.style.background="rgba(255, 0, 0, 0.9)",e.style.color="white",e.style.padding="20px",e.style.zIndex="10000",e.innerHTML="<h3>Game Crash!</h3><pre>".concat(i instanceof Error?i.message+"\n"+i.stack:String(i),"</pre>"),document.body.appendChild(e);let t=document.getElementById("splash-screen");t&&(t.style.display="none")}})()},7790:()=>{}}]);